# QQbot的搭建与简单的功能编写

我们的目标是将自己的小号搭建为一个具备自动回复、发送消息、图片等一切常规QQ执行能力的机器人。

事先说明：napcat后端以及各种应用端的作者团队以及把部署文档等编写的非常完善了，实际上完全跟着官方文档走就可以，所以本教程在这些地方不会讲的太细，主要是分享和解决一些即使跟着官方走也会遇到的诸多问题。

教程更新于2026.1.18，官方团队可能会修改文档和版本，以官方为准。

## 第0步：事先准备

- 一个QQ小号（不使用大号是因为：1，TX的风控力度这几年越来越强，搭建机器人有冻结封号风险；2，部分机器人框架具有“主人”“管理员”等设置，用大号管理小号会更方便）
- 一个能运行程序的设备（可以是你自己的电脑，也可以是你的服务器。机器人程序需要进程持续运行，所以部署到服务器上是个好主意，但是如果没有服务器的话，也可以保证在电脑开着机运行着机器人进程的时候正确完成工作）

## 第1步：部署napcat

我们来到[napcat的官方安装文档](https://www.napcat.wiki/guide/install)。

### 根据情况进行按照

接下来你有以下选择：（先按照下面的来，别管能不能跑通，之后会挨个提到各种情况下遇到问题的处理方案，有新问题可以反馈我，内容会不断更新）

1. 如果你的部署环境是Ubuntu的Linux服务器（无图形化界面）：点击`方法2 - 使用命令行启动`，下滑找到`NapCat.Linux.Launcher - 新式非入侵式启动器`，点击这个条目最后的`NapCat.Linux.Launcher`链接跳转到GitHub仓库。然后在你期望安装的目录下，按照仓库中的README来一步一步安装即可。启动后会控制台有QQ扫码登录，你可以这样做：
   1. 如果扫一扫能识别控制台输出的二维码那可以直接扫
   2. 你也可以去`napcat/cache`文件夹中去找二维码文件，扫起来更方便
   3. 你还可以使用WebUI扫码登录，WebUI的使用请向下翻
2. 如果你是Windows端部署：还是先点击`方法2 - 使用命令行启动`，我们看到官方推荐了两个部署方案：NapCat.Shell - Win 手动启动教程/NapCat.Win.一键版本。后者需要Windows.AMD64，这其实就是64位系统就行，无关你是Intel、AMD还是其他的CPU。
3. 其他端由于本人没有设备，没能自己部署一遍，所以只能靠大家自己跟着官方教程了）
4. 不要点击`在线体验`使用官方的一键安装程序。那个只是个快速体验，运行那个可以看到程序正确启动会得到什么控制台输出，但是不是真正的部署。此外运行这个程序并不会占用电脑内存（似乎），因为运行环境似乎并不是本机。


### 安装中可能遇到的问题以及解决方案

如果你刚才选择了方案1：

- 如果你在README中的第一步`curl`指令失败了：有可能是GitHub被墙了，要么给运行环境科学上网，要么使用其他`curl`指令，README里提供了至少三条。
- 如果你无法运行`Xvfb`指令：
  - 你可能需要安装这个库：`sudo apt update` `sudo apt install xvfb`
  - 不要擅自把指令中的大写X改为小写x，指令确实就是要大写X
- 如果你运行了那条`Xvfb`后，下一条指令输入什么都会报类似`Exit 1`：可能是这句`Xvfb`指令压根没成功运行，后台退出了，前台输入了新指令才把后台退出的信息刷新出来。首先你可以把指令最后面的`&`去掉，运行之后可能会在前台显式输出报错信息，让AI伙伴帮你解决；此外我也有些自己错出来或得到反馈的经验可以分享一下：
  - 有可能是你先前已经运行过一个Xvfb进程，占用了`:1`，你可以通过`lsof -i :6001`查看是否有进程占用端口，或者通过`ps aux | grep Xvfb`查看是否有已有的Xvfb进程。如果找到了，你有两种解决方法：杀掉原进程后重新启动`pkill -f "Xvfb :1"`或者`kill 找到的进程ID`；避开`:1`，将Github中的README中这条`Xvfb`指令和下一条指令中的`:1`改为其他未被占用的数字。
  - 有可能还是你没安装Xvfb库，参见上一条问题和解决方案。
- 如果最后一条指令启动的时候报错没能找到.so的路径：
  - 首先确保你运行指令的路径下确实有那个.so文件（照理说一步步走下来不间断的话应该没问题）
  - 然后检查你是否刚才的指令都毫无错误的进行了，不要自己擅自在开头加上`sudo`，这会导致权限错误，在你以`ubuntu`用户登录时有可能会使有些文件的所有权为`root`，导致无法访问

### WebUI的使用

首先确保你的napcat进程已经成功启动并运行（初次启动的话进程可能会输出登录二维码），然后确保你的运行环境的防火墙是开放了`6099`端口的（针对服务器，在服务器商提供的控制面板即可设置，如果是本机部署的话则不必考虑），最后在浏览器上访问`IPv4地址:6099/webui`即可，这里的IPv4地址，如果是服务器部署则为你服务器的公网IPv4地址，如果是本机部署的话就是`localhost`或者`127.0.0.1`

成功进到WebUI界面后，登录需要填token，这个东西需要你去到`napcat/logs`里找到最新的启动日志文件，在里面你能找到这样一行：`01-17 23:44:31 [info] [NapCat] [WebUi] WebUi User Panel Url: http://127.0.0.1:6099/webui?token=xxxx`，其中的`xxxx`一串就是你的初始密码（token）啦

关于WebUI的更多信息，参见[官方文档](https://www.napcat.wiki/config/basic#%E9%80%9A%E8%BF%87-webui-%E9%85%8D%E7%BD%AE-onebot-%E6%9C%8D%E5%8A%A1)

### NapCat.Windows 可视化管理工具

TODO

## 第2步：选择前端并部署

[这里](https://www.napcat.wiki/use/integration)展示了napcat已经支持对接的框架

TODO